<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>üß† Brain Tumor Classifier</title>
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    body {
      background: radial-gradient(circle at top, #0f172a, #000);
      color: #e2e8f0;
      font-family: 'Poppins', sans-serif;
    }
    .card {
      background: rgba(255,255,255,0.08);
      backdrop-filter: blur(12px);
      border: 1px solid rgba(255,255,255,0.12);
      transition: 0.3s ease;
    }
    .card:hover {
      transform: translateY(-6px);
      box-shadow: 0 0 22px rgba(34,211,238,0.3);
    }
    .neon-text {
      text-shadow: 0 0 14px #22d3ee, 0 0 30px #22d3ee;
    }
    .glow-box {
      box-shadow: 0 0 15px rgba(34,211,238,0.3);
      animation: pulseGlow 2s infinite alternate;
    }
    @keyframes pulseGlow {
      from { box-shadow: 0 0 15px rgba(34,211,238,0.3); }
      to   { box-shadow: 0 0 30px rgba(34,211,238,0.6); }
    }
    #loadingOverlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.7);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 50;
    }
    .spinner {
      width: 60px;
      height: 60px;
      border: 6px solid #22d3ee;
      border-top-color: transparent;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>

<body class="min-h-screen flex flex-col items-center p-4">

<!-- Image Modal -->
<div id="imgModal" class="fixed inset-0 bg-black/80 hidden items-center justify-center z-50">
  <img id="modalImg" class="max-w-[90%] max-h-[90%] rounded-xl border border-cyan-400">
</div>

<!-- Loader -->
<div id="loadingOverlay">
  <div class="spinner"></div>
</div>

<header class="w-full max-w-5xl mt-6 mb-4 text-center">
  <h1 class="text-4xl md:text-5xl font-bold text-cyan-300 neon-text">
    üß† Brain Tumor Classifier
  </h1>
  <p class="text-slate-300 mt-3 text-sm md:text-base">
    AI-powered MRI analysis with explainability (Grad-CAM)
  </p>
</header>

<main class="w-full max-w-5xl grid md:grid-cols-2 gap-8">

  <!-- Upload Section -->
  <section class="card rounded-2xl p-6 flex flex-col items-center">
    <form method="POST" enctype="multipart/form-data" class="w-full space-y-4 text-center">
      <label class="text-slate-200 font-semibold">üìÅ Upload MRI</label>

      <div id="dropZone"
          class="w-full p-6 rounded-xl border-2 border-dashed border-cyan-500 bg-slate-900 text-center cursor-pointer hover:bg-slate-800 transition">
        <p class="text-slate-300">üì• Drag & Drop MRI Image Here</p>
        <p class="text-xs text-slate-500 mt-1">or click to browse</p>

        <input id="fileInput" name="image" type="file" accept="image/*" class="hidden">
      </div>


      <button type="submit"
        class="w-full py-2 rounded-lg bg-cyan-500 hover:bg-cyan-400 text-black font-semibold">
        Predict
      </button>
    </form>

    {% with messages = get_flashed_messages() %}
      {% if messages %}
        <div class="mt-4 space-y-2 text-center">
          {% for m in messages %}
            <div class="text-sm text-red-300 font-medium">{{ m }}</div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}
  </section>

  <!-- Result Section -->
  <section class="card glow-box rounded-2xl p-6">

    {% if pred_label %}
    <div class="space-y-3 text-center">

      <div class="text-lg">
        <span class="text-slate-300">Prediction:</span>
        <span class="font-bold text-cyan-300">{{ pred_label|title }}</span>
      </div>

      <div class="mt-3">
        <div class="flex justify-between text-sm mb-1">
          <span class="text-slate-300">Confidence</span>
          <span id="confValue" class="text-green-400 font-semibold">0%</span>
        </div>
        <div class="w-full bg-slate-800 rounded-full h-3 overflow-hidden">
          <div class="h-full bg-gradient-to-r from-cyan-400 to-green-400 transition-all duration-700"
               style="width: {{ pred_conf }}%">
          </div>
        </div>
      </div>

      <div class="grid md:grid-cols-2 gap-4 mt-4">
  <!-- Original Image -->
        <figure>
          <figcaption class="text-sm text-slate-400 mb-1">Uploaded MRI</figcaption>
          <img src="data:image/jpeg;base64,{{ uploaded_b64 }}"
              onclick="openModal(this.src)"
              class="cursor-zoom-in rounded-lg w-full border border-slate-700 hover:scale-105 transition">
        </figure>

        <!-- GradCAM Image -->
        {% if gradcam_b64 %}
        <figure>
          <figcaption class="text-sm text-slate-400 mb-1">Grad-CAM Analysis</figcaption>
          <img src="data:image/jpeg;base64,{{ gradcam_b64 }}"
              onclick="openModal(this.src)"
              class="cursor-zoom-in rounded-lg w-full border border-cyan-600 hover:scale-105 transition">
        </figure>
        {% endif %}
      </div>


      <div class="mt-6 p-4 rounded-xl bg-slate-900 border border-cyan-700 shadow-lg text-left">
        <h3 class="text-cyan-300 font-semibold mb-2">ü©∫ Medical Insights</h3>

        {% if pred_label == "glioma" %}
        <p class="text-sm text-slate-300">Glioma arises from glial cells.</p>
        <ul class="list-disc pl-5 text-sm text-slate-400 mt-2">
          <li>Consult neurologist</li>
          <li>Frequent MRI scans</li>
          <li>Avoid stress</li>
        </ul>

        {% elif pred_label == "meningioma" %}
        <p class="text-sm text-slate-300">Meningioma forms in brain coverings.</p>
        <ul class="list-disc pl-5 text-sm text-slate-400 mt-2">
          <li>Routine scans</li>
          <li>Monitor memory</li>
          <li>Avoid head trauma</li>
        </ul>

        {% elif pred_label == "pituitary" %}
        <p class="text-sm text-slate-300">Pituitary tumors affect hormones.</p>
        <ul class="list-disc pl-5 text-sm text-slate-400 mt-2">
          <li>Endocrinologist consult</li>
          <li>Vision tests</li>
          <li>Track hormones</li>
        </ul>

        {% elif pred_label == "notumor" %}
        <p class="text-green-400 text-sm">No tumor detected.</p>
        <ul class="list-disc pl-5 text-sm text-slate-400 mt-2">
          <li>Healthy lifestyle</li>
          <li>Hydration</li>
          <li>Routine checkups</li>
        </ul>
        {% endif %}
      </div>

    </div>
    {% else %}
      <div class="flex items-center justify-center h-full text-slate-400">
        Upload an MRI image to begin
      </div>
    {% endif %}

  </section>
</main>

<div class="mt-3 text-xs text-yellow-300 bg-yellow-900/30 border border-yellow-500 rounded-lg p-2">
‚ö†Ô∏è For educational use only. Consult a medical professional.
</div>

<footer class="text-xs text-slate-500 mt-10 text-center">
  Developed by <span class="text-cyan-400 font-semibold">@Krish Gupta</span> | 2025
</footer>
<script>
{% if pred_conf %}
  const target = {{ pred_conf }};
  let current = 0;
  const el = document.getElementById("confValue");
  if (el) {
    const interval = setInterval(() => {
      current++;
      el.innerText = current + "%";
      if (current >= target) clearInterval(interval);
    }, 15);
  }
{% endif %}

  const dropZone = document.getElementById("dropZone");
const fileInput = document.getElementById("fileInput");

dropZone.addEventListener("click", () => fileInput.click());

dropZone.addEventListener("dragover", (e) => {
  e.preventDefault();
  dropZone.classList.add("border-green-400", "bg-slate-800");
});

dropZone.addEventListener("dragleave", () => {
  dropZone.classList.remove("border-green-400", "bg-slate-800");
});

dropZone.addEventListener("drop", (e) => {
  e.preventDefault();
  dropZone.classList.remove("border-green-400", "bg-slate-800");

  const files = e.dataTransfer.files;
  if (files.length > 0) {
    fileInput.files = files;
    dropZone.querySelector("p").innerText = "‚úÖ File ready: " + files[0].name;
  }
});
function openModal(src) {
  const modal = document.getElementById("imgModal");
  const img = document.getElementById("modalImg");
  img.src = src;
  modal.classList.remove("hidden");
  modal.classList.add("flex");
}

document.getElementById("imgModal").onclick = function () {
  this.classList.add("hidden");
  this.classList.remove("flex");
};
</script>

</body>
</html>
